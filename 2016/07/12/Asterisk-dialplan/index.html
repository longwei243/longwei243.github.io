<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>asterisk拨号方案 | Hexo</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">asterisk拨号方案</h1><a id="logo" href="/.">Hexo</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">asterisk拨号方案</h1><div class="post-meta">Jul 12, 2016<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>拨号方案是一种对于asterisk的脚本语言，这是主要的方式来告诉asterisk要干什么。一般在/etc/asterisk/extensions.conf。如果你修改了拨号方案，在命令行里执行dialplan reload来加载它。</p>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><h5 id="context"><a href="#context" class="headerlink" title="context"></a>context</h5><p><code>[users]</code></p>
<h5 id="extensions"><a href="#extensions" class="headerlink" title="extensions"></a>extensions</h5><p>在每一个context里面，可以定义多个extensions,格式如下：<br><code>exten =&gt; number,priority,application([parameter[,parameter2...]])</code></p>
<h5 id="特殊的extensions"><a href="#特殊的extensions" class="headerlink" title="特殊的extensions"></a>特殊的extensions</h5><p>a: Assistant extension<br>e: Exception Catchall extension<br>h: Hangup extension<br>i: Invalid entry extension<br>o: Operator extension<br>s: Start extension<br>t: Response timeout extension<br>T: Absolute timeout extension  </p>
<h5 id="包含"><a href="#包含" class="headerlink" title="包含"></a>包含</h5><p>使用include =&gt; and then the name of the context</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[users]</div><div class="line">include =&gt; features</div><div class="line"></div><div class="line">exten =&gt; 6001,1,Dial(SIP/demo-alice,20)</div><div class="line">   same =&gt; n,VoiceMail(6001@vm-demo,u)</div><div class="line"></div><div class="line">exten =&gt; 6002,1,Dial(SIP/demo-bob,20)</div><div class="line">   same =&gt; n,VoiceMail(6002@vm-demo,u)</div><div class="line"></div><div class="line">[features]</div><div class="line">exten =&gt; 6000,1,Answer(500)</div><div class="line">   same =&gt; n,Playback(hello-world)</div><div class="line">   same =&gt; n,Hangup()</div><div class="line"></div><div class="line">exten =&gt; 6500,1,Answer(500)</div><div class="line">   same =&gt; n,VoiceMailMain(@vm-demo)</div></pre></td></tr></table></figure>
<h5 id="switch"><a href="#switch" class="headerlink" title="switch"></a>switch</h5><p>The switch statement permits a server to share the dialplan with another server.</p>
<h5 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h5><h6 id="通道变量"><a href="#通道变量" class="headerlink" title="通道变量"></a>通道变量</h6><p>设置变量，使用set</p>
<p><code>exten =&gt; 1,2,Set(varname=value)</code></p>
<p>使用变量，用${variablename}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">exten =&gt; 1,1,Set(COUNT=3)</div><div class="line">exten =&gt; 1,n,SayNumber($&#123;COUNT&#125;)</div></pre></td></tr></table></figure>
<p>变量继承<br>单继承 使用_前缀，例如：_FOO<br>多继承 使用<strong>前缀，例如：</strong>FOO</p>
<p>选择变量中的字符<br><code>${variable_name[:offset[:length]]}</code><br>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">; Only save the middle numbers 555 from the string 918005551234  </div><div class="line">exten =&gt; _9X.,1,Set(number=$&#123;EXTEN:5:3&#125;)</div></pre></td></tr></table></figure>
<p>asterisk中的标准变量<br>${CHANNEL} <em> - Current channel name<br>${CONTEXT} </em> - Current context<br>${DATETIME} <em> - Current date time in the format: DDMMYYYY-HH:MM:SS (Deprecated; use ${STRFTIME(${EPOCH},,%d%m%Y-%H:%M:%S)})<br>${EXTEN} </em> - Current extension<br>还有很多 </p>
<h6 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h6><ul>
<li>在[globals]中定义</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[globals]</div><div class="line">MYGLOBALVAR=somevalue</div></pre></td></tr></table></figure>
<ul>
<li>使用GLOBAL()设置<br><code>exten=&gt;6124,1,Set(GLOBAL(MYGLOBALVAR)=somevalue)</code></li>
</ul>
<p>变量操作<br> <code>${variable[:skip[docs::length]}</code></p>
<h5 id="模式匹配"><a href="#模式匹配" class="headerlink" title="模式匹配"></a>模式匹配</h5><p>用_开始</p>
<ul>
<li>X 0-9</li>
<li>Z 1-9</li>
<li>N 2-9</li>
<li>[15-7] 数字范围1、5、6、7</li>
<li>. 一个或多个字符</li>
<li>！ 取反</li>
</ul>
<p><code>exten =&gt; _64XX,1,SayDigits(${EXTEN})</code></p>
<p>匹配caller id</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">example: featuring phones with Caller IDs of 101, 102 and 103</div><div class="line"></div><div class="line">exten =&gt; 306,1,NoOp()</div><div class="line">same =&gt; n,Background(goodbye)</div><div class="line">same =&gt; n,Hangup()</div><div class="line"> </div><div class="line">exten =&gt; 306/_101,1,NoOp()</div><div class="line">same =&gt; n,Background(year)</div><div class="line">same =&gt; n,Hangup()</div><div class="line"> </div><div class="line">exten =&gt; 306/_102,1,NoOp()</div><div class="line">same =&gt; n,Background(beep)</div><div class="line">same =&gt; n,Hangup()</div></pre></td></tr></table></figure>
<h5 id="表达式"><a href="#表达式" class="headerlink" title="表达式"></a>表达式</h5><p><code>$[this]</code></p>
<h5 id="条件应用"><a href="#条件应用" class="headerlink" title="条件应用"></a>条件应用</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">exten =&gt; 1,2,GotoIf($[$&#123;CALLERID(all)&#125; = 123456]?2,1:3,1)</div></pre></td></tr></table></figure>
<h3 id="Applications"><a href="#Applications" class="headerlink" title="Applications"></a>Applications</h3><h5 id="Answer"><a href="#Answer" class="headerlink" title="Answer"></a>Answer</h5><h5 id="Playback"><a href="#Playback" class="headerlink" title="Playback"></a>Playback</h5><h5 id="Hangup"><a href="#Hangup" class="headerlink" title="Hangup"></a>Hangup</h5><h5 id="Dial"><a href="#Dial" class="headerlink" title="Dial"></a>Dial</h5><h5 id="Directory"><a href="#Directory" class="headerlink" title="Directory"></a>Directory</h5><h5 id="Progress"><a href="#Progress" class="headerlink" title="Progress"></a>Progress</h5><h5 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h5><h5 id="Read"><a href="#Read" class="headerlink" title="Read"></a>Read</h5><h5 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h5><h5 id="Verbose-and-NoOp"><a href="#Verbose-and-NoOp" class="headerlink" title="Verbose and NoOp"></a>Verbose and NoOp</h5></div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2016/07/12/Asterisk-dialplan/" data-id="ciqz6khwd00031d0feo1u6npv" class="article-share-link">分享到</a><div class="tags"><a href="/tags/Asterisk/">Asterisk</a></div><div class="post-nav"><a href="/2016/07/23/Asterisk-AEL/" class="pre">Asterisk_AEL</a><a href="/2016/07/08/Asterisk-first/" class="next">Astertisk 入门</a></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Asterisk/" style="font-size: 15px;">Asterisk</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/07/23/Asterisk-AEL/">Asterisk_AEL</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/12/Asterisk-dialplan/">asterisk拨号方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/08/Asterisk-first/">Astertisk 入门</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Hexo.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>