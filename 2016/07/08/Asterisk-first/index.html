<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="今生愿像狂风纵贯东西，哪怕终将消散在苍茫大地"><title>Astertisk 入门 | LongWei</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Astertisk 入门</h1><a id="logo" href="/.">LongWei</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Astertisk 入门</h1><div class="post-meta">Jul 8, 2016<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><h1 id="Astertisk-入门"><a href="#Astertisk-入门" class="headerlink" title="Astertisk 入门"></a>Astertisk 入门</h1><h2 id="1、安装"><a href="#1、安装" class="headerlink" title="1、安装"></a>1、安装</h2><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><h5 id="需要下载的包："><a href="#需要下载的包：" class="headerlink" title="需要下载的包："></a>需要下载的包：</h5><ul>
<li><p>asterisk-{version}-current.tar.gz<br>地址：<a href="http://downloads.asterisk.org/pub/telephony/asterisk/" target="_blank" rel="external">http://downloads.asterisk.org/pub/telephony/asterisk/</a></p>
</li>
<li><p>libpri：The libpri library allows Asterisk to communicate with ISDN connections.You’ll only need this if you are going to use DAHDI with ISDN interface hardware (such as T1/E1/J1/BRI cards).<br>地址：<a href="http://downloads.asterisk.org/pub/telephony/libpri/" target="_blank" rel="external">http://downloads.asterisk.org/pub/telephony/libpri/</a></p>
</li>
<li><p>DAHDI：The DAHDI library allows Asterisk to communicate with analog and digital telephones and telephone lines, including connections to the Public Switched Telephone Network, or PSTN<br>地址：<a href="http://downloads.asterisk.org/pub/telephony/dahdi-linux-complete/" target="_blank" rel="external">http://downloads.asterisk.org/pub/telephony/dahdi-linux-complete/</a></p>
</li>
</ul>
<h3 id="将包放到指定目录中解压"><a href="#将包放到指定目录中解压" class="headerlink" title="将包放到指定目录中解压"></a>将包放到指定目录中解压</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@server ~]# cd /usr/local/src</div><div class="line">[root@server src]# tar -zxvf libpri-1.X.Y.tar.gz</div><div class="line">[root@server src]# tar -zxvf dahdi-linux-complete-2.X.Y+2.X.Y.tar.gz  </div><div class="line">[root@server src]# tar -zxvf asterisk-11-current.tar.gz</div></pre></td></tr></table></figure>
<h3 id="进入对应目录，安装对应的包（make、make-install）"><a href="#进入对应目录，安装对应的包（make、make-install）" class="headerlink" title="进入对应目录，安装对应的包（make、make install）"></a>进入对应目录，安装对应的包（make、make install）</h3><p>DAHDI:      </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@server src]# cd dahdi-linux-complete-2.X.Y+2.X.Y  </div><div class="line">[root@server dahdi-linux-complete-2.X.Y+2.X.Y]# make  </div><div class="line">[root@server dahdi-linux-complete-2.X.Y+2.X.Y]# make install</div><div class="line">[root@server dahdi-linux-complete-2.X.Y+2.X.Y]# make config</div></pre></td></tr></table></figure>
<p>libpri:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@server src]# cd libpri-1.X.Y</div><div class="line">[root@server libpri-1.X.Y]# make</div><div class="line">[root@server libpri-1.X.Y]# make install</div></pre></td></tr></table></figure>
<p>Asterisk:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@server]# cd /usr/local/src/asterisk-11.X.Y</div><div class="line">[root@server asterisk-11.X.Y]# ./configure</div><div class="line">[root@server asterisk-11.X.Y]# make</div><div class="line">[root@server asterisk-11.X.Y]# make install</div><div class="line">[root@server asterisk-11.X.Y]# make samples</div><div class="line">[root@server asterisk-11.X.Y]# make config</div></pre></td></tr></table></figure>
<h3 id="验证是否安装成功"><a href="#验证是否安装成功" class="headerlink" title="验证是否安装成功"></a>验证是否安装成功</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@server asterisk-11.X.Y]# /etc/init.d/asterisk start</div><div class="line">Starting asterisk</div><div class="line">[root@server asterisk-11.X.Y]# /etc/init.d/asterisk status</div><div class="line">asterisk (pid 32117) is running...</div></pre></td></tr></table></figure>
<h2 id="2、目录结构"><a href="#2、目录结构" class="headerlink" title="2、目录结构"></a>2、目录结构</h2><h5 id="asterisk配置文件"><a href="#asterisk配置文件" class="headerlink" title="asterisk配置文件"></a>asterisk配置文件</h5><p><code>astetcdir =&gt; /etc/asterisk</code></p>
<h5 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h5><p><code>astmoddir =&gt; /usr/lib/asterisk/modules</code></p>
<h5 id="变化的文件"><a href="#变化的文件" class="headerlink" title="变化的文件"></a>变化的文件</h5><p><code>astvarlibdir =&gt; /var/lib/asterisk</code></p>
<h5 id="AGI目录"><a href="#AGI目录" class="headerlink" title="AGI目录"></a>AGI目录</h5><p><code>astagidir =&gt; /var/lib/asterisk/agi-bin</code></p>
<h5 id="Running-Process-Directory"><a href="#Running-Process-Directory" class="headerlink" title="Running Process Directory"></a>Running Process Directory</h5><p><code>astrundir =&gt; /var/run/asterisk</code></p>
<h5 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h5><p><code>astlogdir =&gt; /var/log/asterisk</code></p>
<h5 id="System-Binary-Directory"><a href="#System-Binary-Directory" class="headerlink" title="System Binary Directory"></a>System Binary Directory</h5><p><code>astsbindir =&gt; /usr/sbin</code></p>
<h2 id="3、基本操作（CLI）"><a href="#3、基本操作（CLI）" class="headerlink" title="3、基本操作（CLI）"></a>3、基本操作（CLI）</h2><h5 id="启动："><a href="#启动：" class="headerlink" title="启动："></a>启动：</h5><p>asterisk  </p>
<h5 id="远程连接："><a href="#远程连接：" class="headerlink" title="远程连接："></a>远程连接：</h5><p>asterisk -r  </p>
<h5 id="停止"><a href="#停止" class="headerlink" title="停止:"></a>停止:</h5><p>  1    .   core stop now  </p>
<ol>
<li>core stop gracefully  </li>
<li>core stop when convenient<h5 id="重启"><a href="#重启" class="headerlink" title="重启:"></a>重启:</h5>core restart now<br>core restart gracefully<br>core restart when convenient  <h5 id="日志-1"><a href="#日志-1" class="headerlink" title="日志:"></a>日志:</h5>core set verbose ：Set the level of verbose messages to be displayed on the console<br>core set debug：Set the level of debug messages to be displayed or set a module name to display debug messages from<br>logger show channels：List configured logger channels.<br>core show settings：Show miscellaneous core system settings  </li>
</ol>
<blockquote>
<p>Commands follow a general syntax of (module name) (action type) (parameters).<br>For example:<br>sip show peers - returns a list of chan_sip loaded peers<br>voicemail show users - returns a list of app_voicemail loaded users<br>core set debug 5 - sets the core debug to level 5 verbosity.</p>
</blockquote>
<h5 id="sip"><a href="#sip" class="headerlink" title="sip:"></a>sip:</h5><p>sip set debug<br>sip set debug off<br>sip show channels<br>ship show peers</p>
<h2 id="4、基本结构，基础概念"><a href="#4、基本结构，基础概念" class="headerlink" title="4、基本结构，基础概念"></a>4、基本结构，基础概念</h2><h3 id="结构概述"><a href="#结构概述" class="headerlink" title="结构概述"></a>结构概述</h3><p>asterisk有一个核心(core)可以和很多模块(module)进行交互，模块调用通道驱动产生通道(channel)，通道按照拨号方案(dialplan)执行相应的动作，完成asterisk与外部设备的交互。通道与通道可以桥接(bridge)到一起。</p>
<h3 id="Core"><a href="#Core" class="headerlink" title="Core"></a>Core</h3><p>asterisk系统的心脏，PBX核心是基础组件，提供许多基础功能，如读取配置文件、加载和构建拨号方案，这是系统的逻辑，系统才知道如何处理呼入和呼出事件、加载其他模块来实现更多的功能等。</p>
<h3 id="Modules"><a href="#Modules" class="headerlink" title="Modules"></a>Modules</h3><p>提供更多丰富的功能，一般在/usr/lib/asterisk/modules目录下，当系统启动时，模块会被加载。</p>
<ul>
<li>通道驱动模块（Channel Driver Modules） </li>
</ul>
<blockquote>
<p>All calls from the outside of Asterisk go through a channel driver before reaching the core, and all outbound calls go through a channel driver on their way to the external device.  </p>
</blockquote>
<p>   例如：chan_pjsip.so or chan_dahdi.so</p>
<ul>
<li>拨号方案应用模块（Dialplan Application Modules）</li>
</ul>
<blockquote>
<p>The application modules provide call functionality to the system. These applications are then scripted sequentially in the dialpla n. </p>
</blockquote>
<p>   例如:app_voicemail.so</p>
<ul>
<li>拨号方案方法模块(Dialplan Function Modules)</li>
</ul>
<blockquote>
<p>Dialplan functions are somewhat similar to dialplan applications, but instead of doing work on a particular channel or call, they simply retrieve or set a particular setting on a channel, or perform text manipulation.</p>
</blockquote>
<p>例如：func_callerid.so</p>
<ul>
<li>资源模块(Resource Modules)</li>
</ul>
<blockquote>
<p>Resources provide functionality to Asterisk that may be called upon at any time during a call, even while another application is running on the channel. Resources are typically used as asynchronous events such as playing hold music when a call gets placed on hold, or performing call parking.</p>
</blockquote>
<p>例如：res_musiconhold.so</p>
<ul>
<li>编码器模块(Codec Modules)</li>
</ul>
<p>例如：codec_alaw.so</p>
<ul>
<li>其它一些：文件格式模块、CDR模块、桥接模块等</li>
</ul>
<h3 id="Calls-and-Channels"><a href="#Calls-and-Channels" class="headerlink" title="Calls and Channels"></a>Calls and Channels</h3><blockquote>
<p>However in the case of Asterisk a call typically references one or more channels existing in Asterisk.<br>Channels are created by Asterisk using Channel Drivers. They can utilize other resources in the Asterisk system to facilitate various types of communication between one or more devices. Channels can be bridged to other channels and be affected by applications and functions. Channels can make use of many other resources provided by other modules or external libraries. For example SIP channels when passing audio will make use of the codec and format modules. Channels may interact with many different modules at once.   </p>
</blockquote>
<h3 id="Dialplan"><a href="#Dialplan" class="headerlink" title="Dialplan"></a>Dialplan</h3><p>拨号方案影响着asterisk的行为，当书写拨号方案时，通常使用应用和方法来影响通道、配置等。</p>
<h3 id="Bridge"><a href="#Bridge" class="headerlink" title="Bridge"></a>Bridge</h3><p>桥接是一个结构，可以让不同的通道共享媒体。<br>基本的2方桥接<br>native桥接<br>local native bridge</p>
<p>多方桥接</p>
<h2 id="5、配置"><a href="#5、配置" class="headerlink" title="5、配置"></a>5、配置</h2><h3 id="配置文件内容说明"><a href="#配置文件内容说明" class="headerlink" title="配置文件内容说明"></a>配置文件内容说明</h3><p>配置文件内容分为很多部分，每部分的名字用方括号[]包裹，里面有很多设置项，例如：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[section-name]  </div><div class="line">setting=true  </div><div class="line"> </div><div class="line">[another_section]  </div><div class="line">setting=false  </div><div class="line">setting2=true</div></pre></td></tr></table></figure>
<p>设置对象（object）</p>
<p><code>[section-name]
some_object =&gt; settings</code></p>
<p>单行注释使用 ;<br>多行注释使用 ;–  –;<br>包括其它文件 #include filename<br>执行程序  #exec program<br>向已存在的部分添加 使用[section-name]（+）<br>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[section-name]</div><div class="line">setting1=value1</div><div class="line"> </div><div class="line">[section-name](+)</div><div class="line">setting2=value2  </div><div class="line"></div><div class="line">setting2就被添加到了section-name这个部分中了。</div></pre></td></tr></table></figure>
<p>定义模板 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[template-name](!)</div><div class="line">setting=value</div></pre></td></tr></table></figure>
<p>使用模板<br>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[test-one](!)</div><div class="line">permit=192.168.0.2</div><div class="line">host=alpha.example.com</div><div class="line">deny=192.168.0.1</div><div class="line"> </div><div class="line">[test-two](!)</div><div class="line">permit=192.168.1.2</div><div class="line">host=bravo.example.com</div><div class="line">deny=192.168.1.1</div><div class="line"> </div><div class="line">[test-three](test-one,test-two)</div><div class="line">permit=192.168.3.1</div><div class="line">host=charlie.example.com</div></pre></td></tr></table></figure>
<p>The [test-three] section 就会是:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[test-three]</div><div class="line">permit=192.168.0.2</div><div class="line">host=alpha.example.com</div><div class="line">deny=192.168.0.1</div><div class="line">permit=192.168.1.2</div><div class="line">host=bravo.example.com</div><div class="line">deny=192.168.1.1</div><div class="line">permit=192.168.3.1</div><div class="line">host=charlie.example.com</div></pre></td></tr></table></figure>
<p>主配置文件 asterisk.conf<br>日志配置文件 logger.conf<br>模块配置文件 modules.conf<br>sip配置文件 sip.conf<br>拨号方案配置文件 extensions.conf</p>
<h2 id="6、基本例子"><a href="#6、基本例子" class="headerlink" title="6、基本例子"></a>6、基本例子</h2><p>一个最基础的例子，准备asterisk、2个软电话   </p>
<h5 id="创建sip账号"><a href="#创建sip账号" class="headerlink" title="创建sip账号"></a>创建sip账号</h5><p>在sip.conf中创建</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[general]</div><div class="line">transport=udp</div><div class="line"></div><div class="line">[friends_internal](!)</div><div class="line">type=friend</div><div class="line">host=dynamic</div><div class="line">context=from-internal</div><div class="line">disallow=all</div><div class="line">allow=ulaw</div><div class="line"></div><div class="line">[demo-alice](friends_internal)</div><div class="line">secret=verysecretpassword ; put a strong, unique password here instead</div><div class="line"></div><div class="line">[demo-bob](friends_internal)</div><div class="line">secret=othersecretpassword ; put a strong, unique password here instead</div></pre></td></tr></table></figure>
<h5 id="重启：core-restart-now"><a href="#重启：core-restart-now" class="headerlink" title="重启：core restart now"></a>重启：core restart now</h5><h5 id="软电话使用创建的账号注册，使用sip-show-peers查看注册状态。"><a href="#软电话使用创建的账号注册，使用sip-show-peers查看注册状态。" class="headerlink" title="软电话使用创建的账号注册，使用sip show peers查看注册状态。"></a>软电话使用创建的账号注册，使用sip show peers查看注册状态。</h5><h5 id="编写拨号方案"><a href="#编写拨号方案" class="headerlink" title="编写拨号方案"></a>编写拨号方案</h5><p>打开extensions.conf  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[from-internal]</div><div class="line">exten=&gt;6001,1,Dial(SIP/demo-alice,20)</div><div class="line">exten=&gt;6002,1,Dial(SIP/demo-bob,20)</div></pre></td></tr></table></figure>
<p>执行 dialplan reload<br>使用 dialplan show from-internal查看</p>
<h5 id="使用软电话拨打6002或6001"><a href="#使用软电话拨打6002或6001" class="headerlink" title="使用软电话拨打6002或6001"></a>使用软电话拨打6002或6001</h5><p>控制台会打印出信息</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2016/07/08/Asterisk-first/" data-id="ciqz6pj2j0003200fvp57oukf" class="article-share-link">分享到</a><div class="tags"><a href="/tags/Asterisk/">Asterisk</a></div><div class="post-nav"><a href="/2016/07/12/asterisk-dialplan/" class="pre">Asterisk拨号方案</a></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Asterisk/" style="font-size: 15px;">Asterisk</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/07/23/Asterisk-AEL/">Asterisk_AEL</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/12/asterisk-dialplan/">Asterisk拨号方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/08/Asterisk-first/">Astertisk 入门</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">LongWei.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>